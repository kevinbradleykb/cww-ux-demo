<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Water Works - Expert Irrigation Solutions in Northern Michigan</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="https://cdn.emailjs.com/sdk/3.11.0/email.min.js"></script>
</head>
<body>
    <header>
        <nav class="container">
            <a href="#" class="logo">
                <img src="images2/cwwlogo.jpg" alt="Crystal Water Works Logo">
            </a>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#about">About Us</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#products">Products</a></li>
                <li><a href="#testimonials">Testimonials</a></li>
                <li><a href="#contact" class="cta-button">Contact Us</a></li>
            </ul>
            <div class="burger">
                <div></div>
                <div></div>
                <div></div>
            </div>
        </nav>
    </header>

    <main>
        <section id="home" class="hero">
            <div class="container">
                <h1 class="homepage-title">Crystal Water <span class="highlight">Works</span></h1>
                <p>Transforming Northern Michigan landscapes with expert water management since 1985</p>
                <a href="#contact" class="cta-button">Get an Estimate</a>
            </div>
        </section>
        <section id="about" class="about-section">
            <div class="container">
                <h2>Our Growing Company</h2>
                <h3>We Work For You</h3>
                <p class="full-width-text">
                    At Crystal Water Works, our mission is to deliver top-tier irrigation solutions tailored to the unique needs of our clients. We understand that a thriving landscape is not just about watering plants but about enhancing your lifestyle. With decades of experience and a commitment to excellence, we ensure every system we design is efficient, sustainable, and built to last. Your satisfaction is our priority, and we work diligently to exceed your expectations with every project.
                </p>
                <div class="about-content">
                    <div class="about-text">
                        <h3>Our Story</h3>
                        <p>
                            Since 1985, Crystal Water Works has been transforming landscapes throughout Northern Michigan with expert irrigation solutions. With over three decades of experience, we have grown into the region‚Äôs most trusted name in underground sprinkler systems, serving countless satisfied customers with dedication and integrity.
                        </p>
                    </div>
                    <div class="about-image">
                        <img src="images2/about-us.jpg" alt="About Us">
                    </div>
                </div>
            </div>
        </section>
        </section>
        <section id="why-choose-us" class="why-choose-us">
            <div class="container">
                <h2>Why Choose Us?</h2>
                <div class="why-grid">
                    <div class="why-item">
                        <i class="fas fa-hands-helping"></i>
                        <h3>Customer-Centric Service</h3>
                        <p>We offer timely estimates, ensuring that you can make informed decisions without any pressure.</p>
                    </div>
                    <div class="why-item">
                        <i class="fas fa-award"></i>
                        <h3>Certified Excellence</h3>
                        <p>We are the only certified Toro dealer in the area, a testament to our commitment to quality and reliability.</p>
                    </div>
                    <div class="why-item">
                        <i class="fas fa-star"></i>
                        <h3>Trusted Expertise</h3>
                        <p>Serving Northern Michigan for over 35 years, we bring unparalleled knowledge and skill to every project.</p>
                    </div>
                    <div class="why-item">
                        <i class="fas fa-toolbox"></i>
                        <h3>Dependable and Responsive</h3>
                        <p>With a full-time service crew and fully stocked vehicle fleet, we are always prepared to meet your irrigation needs.</p>
                    </div>
                    <div class="why-item">
                        <i class="fas fa-shield-alt"></i>
                        <h3>Peace of Mind</h3>
                        <p>Our new systems come with warranties of up to 5 years, giving you confidence in your investment.</p>
                    </div>
                    <div class="why-item">
                        <i class="fas fa-lightbulb"></i>
                        <h3>Innovative Solutions</h3>
                        <p>We leverage the latest technology and innovative practices to deliver the most efficient and effective irrigation solutions.</p>
                    </div>
                </div>
            </div>
        </section>
        <section id="services" class="services">
            <div class="container">
                <h2>What We Provide</h2>
                <div class="services-grid">
                    <div class="service-card">
                        <i class="fas fa-tint"></i>
                        <h3>Installation</h3>
                        <p>Custom irrigation system design and professional installation</p>
                    </div>
                    <div class="service-card">
                        <i class="fas fa-wrench"></i>
                        <h3>Activations</h3>
                        <p>Initialize systems and checking for winter damage </p>
                    </div>
                    <div class="service-card">
                        <i class="fas fa-snowflake"></i>
                        <h3>Winterization</h3>
                        <p>Protect your system from harsh Michigan winters</p>
                    </div>
                    <div class="service-card">
                        <i class="fas fa-arrow-up"></i>
                        <h3>Repair & Upgrades</h3>
                        <p>Quick diagnositcs and efficient repairs. Enhance your existing system with latest technology for better efficiency and water savings</p>
                    </div>
                </div>
            </div>
        </section>
        <section id="products" class="products">
            <div class="container">
                <h2>What We Use</h2>
                <div class="products-grid">
                    <div class="product-card">
                        <img src="images2/570Z.jpeg" alt="570Z Series Sprinklers">
                        <h3>570Z Series Sprinklers</h3>
                        <p>The 570Z Series Sprinklers are perfect for small, intricate landscape areas, offering precision water distribution to maintain lush, healthy plants.</p>
                    </div>
                    <div class="product-card">
                        <img src="images2/Mini8Series.jpeg" alt="Mini 8 Series">
                        <h3>Mini 8 Series</h3>
                        <p>The Mini 8 Series provides efficient 1/2‚Äù gear-driven irrigation, ideal for areas too large for spray heads yet too small for full-size rotors.</p>
                    </div>
                    <div class="product-card">
                        <img src="images2/super800.jpeg" alt="Super 800 Series">
                        <h3>Super 800 Series</h3>
                        <p>Super 800 Series Rotors are built for large turf areas, with a 5‚Äù pop-up that easily rises above tall grass, ensuring thorough irrigation.</p>
                    </div>
                    <div class="product-card">
                        <img src="images2/controller2.png" alt="Evolution Controller">
                        <h3>Evolution Controller</h3>
                        <p>The Evolution Controller is the automated 'brain' of your system, managing watering schedules with precision and reliability.</p>
                    </div>
                    <div class="product-card">
                        <img src="images2/EZFLOW.jpeg" alt="Toro EZ-Flo Plus Valves">
                        <h3>Toro EZ-Flo Plus Valves</h3>
                        <p>Toro EZ-Flo Plus Valves ensure consistent water flow regulation, tested for extreme conditions and built for lasting performance.</p>
                    </div>
                    <div class="product-card">
                        <img src="images2/febco.jpg" alt="Febco Model 765 Pressure Vacuum Breaker">
                        <h3>Febco Model 765 Pressure Vacuum Breaker</h3>
                        <p>The Febco Model 765 features a 'freeze plug' design for reliable backflow prevention, even in harsh climates.</p>
                    </div>
                    <div class="product-card">
                        <img src="images2/starite2.jpeg" alt="Sta-Rite Pumps">
                        <h3>Sta-Rite Pumps</h3>
                        <p>Sta-Rite Pumps provide rapid priming and efficient water supply from nearby lakes, featuring durable construction for high reliability.</p>
                    </div>
                    <div class="product-card">
                        <img src="images2/trickle.jpg" alt="Trickle - Drip Irrigation">
                        <h3>Trickle - Drip Irrigation</h3>
                        <p>Trickle systems deliver precise water directly to roots, reducing waste and promoting healthier plant growth.</p>
                    </div>
                </div>
            </div>
        </section> 
        <section id="satisfied-customers" class="satisfied-customers">
            <div class="container">
                <h2>Proudly Serving</h2>
                <p>*In addition to serving these esteemed businesses and organizations, we also provide expert irrigation services for residential properties*</p>
                <div class="customer-grid">
                    <ul>
                        <li>Beach House</li>
                        <li>Benzie County Community Resource Center/Benzie & Leelanau Health Dept.</li>
                        <li>Benzie County Historical Museum</li>
                        <li>Central State Bank (Beulah and Benzonia branch locations)</li>
                        <li>Chimeny Corners</li>
                        <li>Cooley Builders</li>
                        <li>Cottage Pros</li>
                        <li>Courthouse Condos</li>
                        <li>Crystal Gardens</li>
                        <li>Crystal Lake Clinic</li>
                        <li>Chimeny Ridge Condos</li>
                    </ul>
                    <ul>
                        <li>East Shore Marina</li>
                        <li>First Congregational Church of Frankfort</li>
                        <li>Frankfort Manufacturing</li>
                        <li>City of Frankfort (Rotary and Mineral Springs Park)</li>
                        <li>Frankfort Pines</li>
                        <li>Frankfort-Elberta Area Schools (ballfields)</li>
                        <li>Gillison Excavating</li>
                        <li>Harbor Lights Resort and Marina</li>
                        <li>Honor State Bank (Benzonia and Loan Office, Beulah)</li>
                        <li>Lake Township Hall and Park</li>
                        <li>Leelanau Coffee Roasting Company</li>
                    </ul>
                    <ul>
                        <li>Michigan Shores</li>
                        <li>N.W. Michigan Medical Center</li>
                        <li>Onekama Consolidated Schools</li>
                        <li>Riverhaven Estates</li>
                        <li>St. Philips Church</li>
                        <li>State Savings Bank</li>
                        <li>Staphanski Dental</li>
                        <li>Store It on <Main></Main></li>
                        <li>Stormcloud</li>
                        <li>Watervale Inn</li>
                        <li>Wildflower Welcome Site Committee of Periwinkle Garden Club</li>
                    </ul>
                </div>
            </div>
        </section>
        <section id="testimonials" class="testimonials">
            <div class="container">
                <h2>What Our Clients Have Been Saying</h2>
                <div class="testimonial-slider">
                    <div class="testimonial">
                        <p>"Crystal Water Works transformed our property with their exceptional service. Our lawn has never looked better!"</p>
                        <strong>- John D., Manistee</strong>
                    </div>
                    <div class="testimonial">
                        <p>"Their customer service is top-notch. They always go the extra mile to ensure we‚Äôre satisfied."</p>
                        <strong>- Sarah L., Benzie County</strong>
                    </div>
                    <div class="testimonial">
                        <p>"The irrigation system installation was flawless. We‚Äôve seen a significant improvement in our landscape‚Äôs health."</p>
                        <strong>- Mark H., Frankfort</strong>
                    </div>
                    <div class="testimonial">
                        <p>"Highly recommend them for their professional approach and attention to detail."</p>
                        <strong>- Lisa M., Bear Lake</strong>
                    </div>
                    <div class="testimonial">
                        <p>"Their team was very responsive and handled everything efficiently. Couldn‚Äôt be happier!"</p>
                        <strong>- Karen S., Glen Arbor</strong>
                    </div>
                    <div class="testimonial">
                        <p>"Reliable service with a personal touch. They treat your property as if it were their own."</p>
                        <strong>- Peter T., Beulah</strong>
                    </div>
                    <div class="testimonial">
                        <p>"Crystal Water Works offered the best warranty on our new system, giving us peace of mind."</p>
                        <strong>- Emily R., Frankfort</strong>
                    </div>
                    <div class="testimonial">
                        <p>"Their innovative solutions have made our irrigation system more efficient than ever before."</p>
                        <strong>- David W., Leland</strong>
                    </div>
                    <div class="testimonial">
                        <p>"They were on time, professional, and exceeded our expectations in every way."</p>
                        <strong>- Rachel K., Elberta</strong>
                    </div>
                    <div class="testimonial">
                        <p>"Excellent service from start to finish. We‚Äôll definitely use them again for future projects."</p>
                        <strong>- Greg B., Empire</strong>
                    </div>
                </div>
            </div>
        </section>
        <section id="contact" class="contact">
            <div class="container">
                <h2>Reach out today!</h2> 
                <form id="contact-form" action="https://formsubmit.co/crystalwaterworks@gmail.com" method="POST">
                    <input type="hidden" name="_subject" value="New inquiry from Crystal Water Works website">
                    <input type="text" name="name" placeholder="Your Name" required>
                    <input type="email" name="email" placeholder="Your Email" required>
                    <input type="tel" name="phone" placeholder="Your Phone Number">
                    <textarea name="message" placeholder="How can we help you?" required></textarea>
                    <input type="hidden" name="_next" value="https://crystalwaterworks.github.io/thanks.html">
                    <button type="submit" class="cta-button">Send Message</button>
                </form>
            </div>
        </section>
            </div>
        </section>
    </main>
   <footer>
    <div class="footer-content">
        <div class="footer-section">
            <h3>Crystal Water Works</h3>
            <p>360 Day Avenue, Frankfort, MI 49635</p>
            <p>Phone: 231-352-9253</p>
            <img src="images2/cwwlogo.jpg" alt="Crystal Water Works Logo" class="footer-logo"> <!-- Add this line -->
        </div>
        <div class="footer-section">
            <h3>Quick Links</h3>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#testimonials">Testimonials</a></li>
            </ul>
        </div>
                <!-- Leave Us a Review Section -->
<section id="leave-review" class="leave-review">
    <div class="container">
        <h2>We Value Your Feedback!</h2>
        <p>Your reviews help us improve and continue providing top-notch service. If you've enjoyed our services, please leave us a review.</p>
        <a href="https://www.google.com/search?q=crystal+water+works&oq=crystal+water+works&gs_lcrp=EgZjaHJvbWUqCggAEAAY4wIYgAQyCggAEAAY4wIYgAQyDQgBEC4YrwEYxwEYgAQyBggCEEUYQDIMCAMQRRg7GIAEGKIEMggIBBAAGBYYHjINCAUQABiGAxiABBiKBTIGCAYQRRg8MgYIBxBFGD3SAQgyMTc0ajBqN6gCALACAA&sourceid=chrome&ie=UTF-8#lrd=0x881e75184dfd57bf:0xabbe91ba04f783e0,3,,,," class="review-button">Leave Us a Review</a>
    </div>
</section>
            <div class="footer-bottom">
                <p>&copy; 2024 Crystal Water Works. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="text/javascript">
        (function() {
            emailjs.init("OvxBoAeOh8WVtJn3o");
        })();
    </script>
    <script src="script.js"></script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Water Works - Chatbot Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #002F6C;
            margin-bottom: 10px;
        }

        .setup-panel {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .setup-panel h2 {
            color: #002F6C;
            margin-bottom: 20px;
        }

        .api-key-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .start-button {
            background-color: #228B22;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .start-button:hover {
            background-color: #1a6b1a;
        }

        .start-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .chat-container {
            display: none;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            height: 600px;
            overflow: hidden;
        }

        .chat-header {
            background-color: #002F6C;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            height: 440px;
            overflow-y: auto;
            padding: 20px;
            background-color: #fafafa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
        }

        .message-user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 10px;
            line-height: 1.4;
        }

        .message-user .message-content {
            background-color: #002F6C;
            color: white;
        }

        .message-bot .message-content {
            background-color: white;
            border: 1px solid #e0e0e0;
            color: #333;
        }

        .chat-input-area {
            padding: 20px;
            background-color: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .send-button {
            background-color: #002F6C;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .send-button:hover {
            background-color: #001f4a;
        }

        .send-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .quick-actions {
            padding: 15px 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            background-color: #fafafa;
        }

        .quick-action {
            background-color: white;
            border: 1px solid #ddd;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-action:hover {
            background-color: #002F6C;
            color: white;
            border-color: #002F6C;
        }

        .loading {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #666;
            border-radius: 50%;
            animation: loading 1.4s infinite ease-in-out both;
            margin: 0 2px;
        }

        @keyframes loading {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .collected-info {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Crystal Water Works Chatbot Demo</h1>
            <p>Test your customer service chatbot before deployment</p>
        </div>

        <div class="setup-panel" id="setupPanel">
            <h2>Setup Your Chatbot</h2>
            <div class="warning">
                ‚ö†Ô∏è This is for testing only. Never put your API key in production code. Use the secure backend implementation for your live website.
            </div>
            <p style="margin-bottom: 15px;">Enter your OpenAI API key to start testing the chatbot:</p>
            <input 
                type="password" 
                class="api-key-input" 
                id="apiKey" 
                placeholder="sk-..."
                onkeypress="if(event.key === 'Enter') startChatbot()"
            >
            <button class="start-button" onclick="startChatbot()">Start Chatbot</button>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="chat-header">
                <div>
                    <h3>Crystal Water Works Support</h3>
                    <p style="font-size: 12px; opacity: 0.9;">Irrigation Assistant</p>
                </div>
                <button onclick="resetChatbot()" style="background: none; border: none; color: white; cursor: pointer; font-size: 24px;">√ó</button>
            </div>

            <div class="quick-actions" id="quickActions">
                <button class="quick-action" onclick="sendQuickMessage('What are your current service prices?')">Service Pricing</button>
                <button class="quick-action" onclick="sendQuickMessage('I need to schedule a spring activation')">Schedule Activation</button>
                <button class="quick-action" onclick="sendQuickMessage('When should I winterize my system?')">Winterization Info</button>
                <button class="quick-action" onclick="sendQuickMessage('I have a broken sprinkler head')">Report Problem</button>
                <button class="quick-action" onclick="sendQuickMessage('Do you service Lake Leelanau area?')">Service Areas</button>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message message-bot">
                    <div class="message-content">
                        Welcome to Crystal Water Works! üëã<br><br>
                        I'm here to help with all your irrigation needs. I can assist you with:<br><br>
                        ‚Ä¢ Service pricing and quotes<br>
                        ‚Ä¢ Scheduling for activation or winterization<br>
                        ‚Ä¢ Information about our products and systems<br>
                        ‚Ä¢ Troubleshooting common issues<br>
                        ‚Ä¢ General questions about irrigation<br><br>
                        How can I help you today?
                    </div>
                </div>
            </div>

            <div class="chat-input-area">
                <input 
                    type="text" 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Type your message here..."
                    onkeypress="if(event.key === 'Enter' && !isLoading) sendMessage()"
                >
                <button class="send-button" id="sendButton" onclick="sendMessage()">Send</button>
            </div>
        </div>

        <div class="collected-info" id="collectedInfo" style="display: none;">
            <h3>Customer Information Collected</h3>
            <p>In production, this information would be automatically emailed to crystalwaterworks@gmail.com</p>
            <div id="infoDetails"></div>
        </div>
    </div>

    <script>
        let apiKey = '';
        let messages = [];
        let isLoading = false;

        const companyContext = `You are a helpful and friendly customer service chatbot for Crystal Water Works, a premier irrigation company in Northern Michigan serving the area since 1985. 

Key Company Information:
- Location: 360 Day Avenue, Frankfort, MI 49635
- Phone: 231-352-9253
- Email: crystalwaterworks@gmail.com
- Website: crystalwaterworks.com

Services & 2025 Pricing:
- Spring Activation: $140 (standard backflow device), $180 (lake pump system)
- Fall Winterization: $145 (standard backflow device), $190 (lake pump system)
- Combined Spring & Fall Prepay Discount: $270 (backflow), $350 (lake pump)
- Installation: Custom quotes required (free estimates available)
- Repairs & Upgrades: Varies by scope of work
- Emergency service available for urgent repairs

Products We Install:
- Toro 570Z Series Sprinklers (perfect for small, detailed areas)
- Toro Mini 8 Series (ideal for medium-sized areas)
- Toro Super 800 Series Rotors (excellent for large turf areas)
- Evolution Controllers (smart irrigation control)
- Toro EZ-Flo Plus Valves (reliable water flow control)
- Febco Model 765 Backflow Preventers (freeze-resistant design)
- Sta-Rite Pumps (for lake water systems)
- Drip/Trickle irrigation systems (water-efficient for gardens)

Service Area: Frankfort, Beulah, Benzonia, Lake Leelanau, Manistee, Glen Arbor, Empire, Elberta, Honor, Onekama, Bear Lake, and surrounding Northern Michigan communities

Our Team:
- Scott Bradley (Owner)
- Linda Mills (Office Manager) 
- Don Roth (Field Operations Manager)
- Mike Nerg (Senior Technician with 30+ years experience)

Important Information:
- We are the only certified Toro dealer in the area
- New system warranties up to 5 years
- Full-time service crew for quick response
- Lake pump installations require electrical setup
- Spring activations typically scheduled late April through May
- Fall winterizations must be completed before first hard freeze (usually by late October)

Common Issues We Handle:
- Stuck or broken sprinkler heads
- Controller programming and timer issues
- Leak detection and repair
- Zone coverage adjustments
- Pump maintenance and repairs
- Winter damage assessment and repair
- System efficiency upgrades

When customers need quotes or want to schedule service:
1. Politely collect their information: Full name, Phone number, Email address, Property address, Type of service needed, Preferred timeframe
2. Let them know their information will be forwarded to our office
3. Inform them someone will contact them within 1-2 business days
4. For emergencies, encourage them to call 231-352-9253 directly

Always maintain a friendly, professional, and helpful tone. If you're unsure about specific technical details, acknowledge this and offer to have one of our experienced technicians provide more detailed information.`;

        function startChatbot() {
            const apiKeyInput = document.getElementById('apiKey');
            apiKey = apiKeyInput.value.trim();
            
            if (!apiKey) {
                alert('Please enter your OpenAI API key');
                return;
            }

            document.getElementById('setupPanel').style.display = 'none';
            document.getElementById('chatContainer').style.display = 'block';
            
            messages = [{
                role: 'system',
                content: companyContext
            }];
        }

        function resetChatbot() {
            if (confirm('Are you sure you want to end this chat session?')) {
                document.getElementById('setupPanel').style.display = 'block';
                document.getElementById('chatContainer').style.display = 'none';
                document.getElementById('collectedInfo').style.display = 'none';
                document.getElementById('apiKey').value = '';
                apiKey = '';
                messages = [];
            }
        }

        function sendQuickMessage(text) {
            document.getElementById('chatInput').value = text;
            sendMessage();
            document.getElementById('quickActions').style.display = 'none';
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const messageText = input.value.trim();
            
            if (!messageText || isLoading) return;

            isLoading = true;
            document.getElementById('sendButton').disabled = true;
            
            // Add user message
            addMessage(messageText, 'user');
            messages.push({ role: 'user', content: messageText });
            
            input.value = '';
            
            // Show loading
            showLoading();

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4-turbo-preview',
                        messages: messages,
                        temperature: 0.7,
                        max_tokens: 500
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const botResponse = data.choices[0].message.content;
                
                removeLoading();
                addMessage(botResponse, 'bot');
                messages.push({ role: 'assistant', content: botResponse });
                
                // Check if customer info was collected
                checkForCustomerInfo(messages);
                
            } catch (error) {
                removeLoading();
                addMessage('I apologize, but I encountered an error. Please check your API key or try again later. For immediate assistance, call us at 231-352-9253.', 'bot');
            } finally {
                isLoading = false;
                document.getElementById('sendButton').disabled = false;
            }
        }

        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = text.replace(/\n/g, '<br>');
            
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showLoading() {
            const messagesDiv = document.getElementById('chatMessages');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingMessage';
            loadingDiv.className = 'message message-bot';
            loadingDiv.innerHTML = `
                <div class="message-content">
                    <span class="loading"></span>
                    <span class="loading" style="animation-delay: 0.2s"></span>
                    <span class="loading" style="animation-delay: 0.4s"></span>
                </div>
            `;
            messagesDiv.appendChild(loadingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function removeLoading() {
            const loading = document.getElementById('loadingMessage');
            if (loading) loading.remove();
        }

        function checkForCustomerInfo(conversation) {
            const lastMessage = conversation[conversation.length - 1].content.toLowerCase();
            if (lastMessage.includes('contact') && 
                (lastMessage.includes('1-2 business days') || 
                 lastMessage.includes('office will') || 
                 lastMessage.includes('forwarded'))) {
                
                // Extract potential customer info
                const fullConversation = conversation.map(m => m.content).join('\n');
                const phoneMatch = fullConversation.match(/\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/);
                const emailMatch = fullConversation.match(/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/);
                
                let service = 'General Inquiry';
                if (fullConversation.toLowerCase().includes('winteriz')) service = 'Winterization';
                else if (fullConversation.toLowerCase().includes('activat')) service = 'Spring Activation';
                else if (fullConversation.toLowerCase().includes('install')) service = 'New Installation';
                else if (fullConversation.toLowerCase().includes('repair')) service = 'Repair Service';
                else if (fullConversation.toLowerCase().includes('leak')) service = 'Emergency Repair';
                
                document.getElementById('collectedInfo').style.display = 'block';
                document.getElementById('infoDetails').innerHTML = `
                    <p><strong>Service Type:</strong> ${service}</p>
                    <p><strong>Phone:</strong> ${phoneMatch ? phoneMatch[0] : 'Not provided'}</p>
                    <p><strong>Email:</strong> ${emailMatch ? emailMatch[0] : 'Not provided'}</p>
                    <p><strong>Conversation ID:</strong> ${Date.now()}</p>
                    <p style="margin-top: 10px; font-style: italic;">
                        In the live version, this information would be automatically sent to your email.
                    </p>
                `;
            }
        }
    </script>
</body>
</html>
</body>
</html>
